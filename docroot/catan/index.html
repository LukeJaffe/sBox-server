<html>
<body>

<style>
.my_canvas {
    background: #eee; 
    width: 700px; 
    height: 700px; 
    border: 1px #ccc solid;
}
</style>


<canvas id="board" class="my_canvas" width='700px' height='700px'></canvas> 
<img src="forest.jpg" id = "forest" alt="forest" height="42" width="42">

<script type="text/javascript">

var canvas, context;

// get a reference to the board, and the drawing context
canvas  = document.getElementById('board');
if ( canvas && canvas.getContext ) 
{
    context = canvas.getContext('2d');

} 
else 
{
    // unsupported browser?
    alert("Couldn't get a reference to the HTML 5 canvas."
      + "\nYour browser doesn't appear to support this page.");
}

function clearCanvas( context, canvas ) 
{
    context.clearRect( 0, 0, canvas.width, canvas.height );
}


/* HexType class with solid color background*/
function HexTypeSolid(resource, roll)
{
    this.resource = resource
    this.roll = roll
    if (this.resource == 'wood')
        this.color = '#663300';
    else if (this.resource == 'wheat')
        this.color = '#FFFF00';
    else if (this.resource == 'pasture')
        this.color = '#00FF00';
    else if (this.resource == 'stone')
        this.color = '#666666';
    else if (this.resource == 'copper')
        this.color = '#FF0000';
    else if (this.resource == 'desert')
        this.color = '#967117';
}

/* HexType class with solid color background*/
function HexTypeTexture(resource, roll)
{
    this.resource = resource
    this.roll = roll
    if (this.resource == 'wood')
    {
        var img = document.getElementById("forest");
        this.color = context.createPattern(img, "repeat");
    }
    else if (this.resource == 'wheat')
        this.color = '#FFFF00';
    else if (this.resource == 'pasture')
        this.color = '#00FF00';
    else if (this.resource == 'stone')
        this.color = '#666666';
    else if (this.resource == 'copper')
        this.color = '#FF0000';
    else if (this.resource == 'desert')
        this.color = '#967117';
}


/* Hex class */
function Hex(x, y, r, t)
{
    /* Store inputs */
    this.x = x;
    this.y = y;
    this.r = r;
    this.t = t;
    this.s = false;

    /* Calculate and store vertices */
    a = (Math.sqrt(3)/2)*r;
    b = r/2
    v = [];
    v.push([x+r, y]);
    v.push([x+b, y-a]);
    v.push([x-b, y-a]);
    v.push([x-r, y]);
    v.push([x-b, y+a]);
    v.push([x+b, y+a]);
    v.push([x+r, y]);
    this.v = v
}

function clippedBackgroundImage( ctx, img, w, h )
{
    ctx.save(); // Save the context before clipping
    ctx.clip(); // Clip to whatever path is on the context

    var imgHeight = w / img.width * img.height;
    if (imgHeight < h){
    ctx.fillStyle = '#000';
    ctx.fill();
    }
    ctx.drawImage(img,0,0,w,imgHeight);

    ctx.restore(); // Get rid of the clipping region
}

function slashedRectWithBG( ctx, x, y, w, h, slash, img ){
  ctx.save(); // Save the context before we muck up its properties
  ctx.translate(x,y);
  ctx.beginPath();
  ctx.moveTo( slash, 0 );       //////////// 
  ctx.lineTo( w, 0 );          //         //
  ctx.lineTo( w, h-slash );   //          //
  ctx.lineTo( w-slash,h );    //          //
  ctx.lineTo( 0, h );         //         //
  ctx.lineTo( 0, slash );     ////////////
  ctx.closePath();
  clippedBackgroundImage( ctx, img, w, h );
  ctx.stroke();  // Now draw our path
  ctx.restore(); // Put the canvas back how it was before we started
}

Hex.prototype.draw = function()
{
    var img = document.getElementById("forest");

    /* Draw fill */
    /*
    context.fillStyle = this.t.color;
    context.beginPath();
    context.moveTo(this.v[0][0], this.v[0][1]);
    for (var i = 1; i < this.v.length; i++)
    {
        x = this.v[i][0];
        y = this.v[i][1];
        context.lineTo(x,y);
    }
    context.closePath();
    context.fill();
    */

    /* Draw outline */
    context.fillStyle = '#000000';
    context.beginPath();
    context.moveTo(this.v[0][0], this.v[0][1]);
    for (var i = 1; i < this.v.length; i++)
    {
        x = this.v[i][0];
        y = this.v[i][1];
        context.lineTo(x,y);
    }
    context.stroke();

    /* Draw roll circles */
    context.beginPath();
    context.arc(this.x, this.y, this.r/3, 0, 2*Math.PI);
    context.stroke();

    /* Draw roll numbers */
    context.font = "30px Arial";
    if (this.t.roll < 10)
        xoff = r/10;
    else
        xoff = r/5
    context.fillText(this.t.roll.toString(), this.x-xoff, this.y+r/10);
}

Hex.prototype.select = function()
{
    this.s = true;
}

Hex.prototype.deselect = function()
{
    this.s = false;
}

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

function start()
{
    x0 = 350;
    y0 = 350;
    r = 75;

    a = r*0.5;
    b = r*Math.sqrt(3)/2;

    num_hexes = 19;

    resources = ['wood', 'wood', 'wood', 'wood',
                'wheat', 'wheat', 'wheat', 'wheat',
                'pasture', 'pasture', 'pasture', 'pasture',
                'stone', 'stone', 'stone',
                'copper', 'copper', 'copper',
                'desert'];

    rolls = [2, 3, 3, 4, 4, 5, 5, 6, 6, 8, 8, 9, 9, 10, 10, 11, 11, 12, 7];

    origins = [ 
                [0, 0],
                [0, 2*b], [1.5*r, b], [1.5*r, -b],        //First circle
                [0, -2*b], [-1.5*r, -b], [-1.5*r, b],     //First circle
                [0, 4*b], [3*r, 2*b], [3*r, -2*b],        //Second circle p1
                [0, -4*b], [-3*r, -2*b], [-3*r, 2*b],     //Second circle p1
                [3*r, 0], [1.5*r, 3*b], [1.5*r, -3*b],    //Second circle p2
                [-3*r, 0], [-1.5*r, -3*b], [-1.5*r, 3*b]  //Second circle p2
              ]

    /* Shuffle indeces */
    indices = [];
    for (var i = 0; i < num_hexes; i++)
        indices.push(i);
    shuffle(indices);

    hexes = [];
    for (var i = 0; i < num_hexes; i++)
    {
        idx = indices[i]
        /* Create all needed hexes */
        hexes.push(new Hex(x0+origins[i][0], y0+origins[i][1], r, 
            new HexTypeTexture(resources[idx], rolls[idx])));
    } 

    /* Draw all hexes */
    for (var i = 0; i < origins.length; i++)
        hexes[i].draw();
}

start();

</script> 

</body>
</html>
